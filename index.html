<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #1a1a1a;
    }
    canvas {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <script>
    let cs;
    let bgColor, fgColor;

    function setup() {
      cs = min(windowHeight, windowWidth);
      createCanvas(cs, cs);
      colorMode(HSB, 360, 100, 100, 100);
      noLoop();
      initColors();
    }

    function initColors() {
      let palettes = [
        { h: random(0, 360), s: random(40, 70), b: random(50, 80) },
        { h: random(270, 290), s: random(50, 80), b: random(40, 70) },
        { h: random(340, 355), s: random(60, 80), b: random(25, 45) },
        { h: random(330, 350), s: random(40, 60), b: random(80, 95) },
        { h: random(50, 60), s: random(80, 100), b: random(90, 100) },
        { h: random(20, 35), s: random(80, 100), b: random(45, 65) }
      ];

      let baseColor = palettes[floor(random(palettes.length))];
      let shift = random(1, 4);
      let fgDominant = random() > 0.5;

      if (fgDominant) {
        bgColor = { h: baseColor.h, s: baseColor.s, b: baseColor.b - shift };
        fgColor = { h: baseColor.h, s: baseColor.s, b: baseColor.b + shift };
      } else {
        bgColor = { h: baseColor.h, s: baseColor.s, b: baseColor.b + shift };
        fgColor = { h: baseColor.h, s: baseColor.s, b: baseColor.b - shift };
      }
    }

    function draw() {
      background(bgColor.h, bgColor.s, bgColor.b, 100);

      let sw = cs * 0.071;
      let margin = sw;
      let cellSize = cs / 8.4;
      let quadStep = cs / 14;
      let range = cs * 0.1;

      for (let rowY = margin; rowY <= cs - margin - range; rowY += cellSize) {
        for (let quadX = margin; quadX <= cs - margin - range; quadX += quadStep) {

          if (random() > 0.2) {
            let hueDrift = fgColor.h + random(-2, 2);
            stroke(hueDrift, fgColor.s, fgColor.b, 100);
            strokeWeight(sw);
            noFill();

            let minX = quadX;
            let maxX = quadX + range;
            let minY = rowY;
            let maxY = rowY + range;

            quad(
              random(minX, maxX), random(minY, maxY),
              random(minX, maxX), random(minY, maxY),
              random(minX, maxX), random(minY, maxY),
              random(minX, maxX), random(minY, maxY)
            );
          }
        }
      }
    }

    function mousePressed() {
      initColors();
      redraw();
    }

    function keyPressed() {
      if (key === 's' || key === 'S') {
        save("camouflage.png");
      }
    }

    function windowResized() {
      cs = min(windowHeight, windowWidth);
      resizeCanvas(cs, cs);
      initColors();
      redraw();
    }
  </script>
</body>
</html>
